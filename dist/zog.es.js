let e=null;const t=[];class n{subs=/* @__PURE__ */new Set;depend(){e&&!this.subs.has(e)&&(this.subs.add(e),e.deps.push(this))}notify(){new Set(this.subs).forEach(t=>{t!==e&&(t.scheduler?t.scheduler(t.run.bind(t)):r(t))})}}let s=[],i=!1;const r=e=>{s.includes(e)||(s.push(e),i||(i=!0,Promise.resolve().then(o)))},o=()=>{try{s.sort((e,t)=>(e.id||0)-(t.id||0));for(const t of s)if(t.active)try{t.run()}catch(e){}}finally{s=[],i=!1}};let c=0;class l{constructor(e,t=null){this.id=c++,this.fn=e,this.scheduler=t,this.deps=[],this.active=!0}run(){if(!this.active)return this.fn();this.cleanup();try{return t.push(this),e=this,this.fn()}finally{t.pop(),e=t.at(-1)||null}}cleanup(){for(const e of this.deps)e.subs.delete(this);this.deps=[]}stop(){this.active&&(this.cleanup(),this.active=!1)}}const f=(e,t={})=>{const n=new l(e,t.scheduler);return n.run(),()=>n.stop()},a=Symbol("raw"),u=Symbol("isReactive"),d=/* @__PURE__ */new WeakMap,h=e=>e&&"object"==typeof e,p=/* @__PURE__ */new Set(["push","pop","shift","unshift","splice","sort","reverse","fill","copyWithin"]),y=/* @__PURE__ */new Set(["includes","indexOf","lastIndexOf","find","findIndex","some","every","filter","map","forEach","reduce","reduceRight","flat","flatMap","join","slice","concat"]),m=e=>{if(!h(e)||e[u])return e;const t=d.get(e);if(t)return t;const s=Array.isArray(e),i=/* @__PURE__ */new Map,r=new n,o=e=>i.get(e)||(i.set(e,new n),i.get(e)),c=e=>{const t=p.has(e),n=y.has(e);return function(...s){const i=this[a];n&&(r.depend(),o("length").depend());const c=i[e].apply(i,s.map(e=>h(e)&&e[u]?e[a]:e));if(t&&(r.notify(),o("length").notify(),"sort"===e||"reverse"===e))for(let e=0;e<i.length;e++)o(String(e)).notify();return h(c)&&!c[u]?m(c):c}},l=s?Object.fromEntries([...p,...y].map(e=>[e,c(e)])):null,f=new Proxy(e,{get:(e,t,n)=>{if(t===u)return!0;if(t===a)return e;if(s&&l?.[t])return l[t].bind(n);if(s&&"length"===t)return o("length").depend(),r.depend(),e.length;if(t===Symbol.iterator)return r.depend(),function*(){for(let t=0;t<e.length;t++)yield h(e[t])?m(e[t]):e[t]};o(t).depend();const i=Reflect.get(e,t,n);return i?._isRef?i:h(i)?m(i):i},set:(e,t,n,i)=>{const c=e[t],l=Number(t),f=s?Number.isInteger(l)&&l>=0&&l<e.length:Object.hasOwn(e,t),d=h(n)&&n[u]?n[a]:n,p=Reflect.set(e,t,d,i);return Object.is(c,d)||(o(t).notify(),(!f||s&&"length"===t)&&(r.notify(),s&&o("length").notify())),p},deleteProperty:(e,t)=>{const n=t in e,s=Reflect.deleteProperty(e,t);return n&&(o(t).notify(),r.notify()),s},ownKeys:e=>(r.depend(),Reflect.ownKeys(e)),has:(e,t)=>(r.depend(),o(t).depend(),Reflect.has(e,t))});return d.set(e,f),f},v=e=>{const t=new n;return{_isRef:!0,get value(){return t.depend(),e},set value(n){Object.is(n,e)||(e=n,t.notify())},toString:()=>String(e)}},b=e=>{let t,s=!0;const i=new n,r=new l(e,()=>{s||(s=!0,i.notify())});return{_isRef:!0,get value(){return s&&(t=r.run(),s=!1),i.depend(),t},_effect:r}};class g{constructor(e){this.data=e,this.effects=[],this.listeners=[]}addEffect(e){this.effects.push(e)}addListener(e,t,n){this.listeners.push({el:e,ev:t,fn:n})}cleanup(){this.effects.forEach(e=>e()),this.listeners.forEach(({el:e,ev:t,fn:n})=>e.removeEventListener(t,n)),this.effects=[],this.listeners=[]}}const w=/* @__PURE__ */new Map,E=(e,t)=>{try{let n=w.get(e);if(!n){const s=Object.keys(t);n={fn:Function(...s,`"use strict";return(${e})`),keys:s},w.size>200&&w.delete(w.keys().next().value),w.set(e,n)}return n.fn(...n.keys.map(e=>{const n=t[e];return n?._isRef?n.value:n}))}catch{return}},A=(e,t,n)=>{if(e){if(3===e.nodeType){const s=e.textContent;return void(s.includes("{{")&&n.addEffect(f(()=>{e.textContent=s.replace(/{{\s*(.*?)\s*}}/g,(e,n)=>E(n,t)??"")})))}if(1===e.nodeType){if(e.hasAttribute("z-if")){const s=[],i=e.parentNode;if(!i)return;const r=document.createComment("z-if");i.insertBefore(r,e);let o=e;for(;o;){const e=["z-if","z-else-if","z-else"].find(e=>o.hasAttribute(e));if(!e)break;const t=o.getAttribute(e);o.removeAttribute(e),s.push({template:o.cloneNode(!0),exp:t,type:e,el:null,scope:null});const n=o.nextElementSibling;o.remove(),o=n}return n.addEffect(f(()=>{const e=s.find(e=>"z-else"===e.type||E(e.exp,t));s.forEach(n=>{n===e?n.el?.parentNode||(n.scope?.cleanup(),n.el=n.template.cloneNode(!0),n.scope=new g({...t}),i.insertBefore(n.el,r),A(n.el,n.scope.data,n.scope)):(n.el?.parentNode&&n.el.remove(),n.scope?.cleanup(),n.scope=null,n.el=null)})})),void n.addEffect(()=>s.forEach(e=>e.scope?.cleanup()))}if(!e.hasAttribute("z-else-if")&&!e.hasAttribute("z-else")){if(e.hasAttribute("z-for")){const s=e.getAttribute("z-for"),i=s.match(/^\s*(?:\((\w+)\s*,\s*(\w+)\)|(\w+))\s+(?:in|of)\s+(.*)$/);let r="item",o="index",c=s;if(i)r=i[1]||i[3],o=i[2]||"index",c=i[4];else{const e=s.split(/\s+(?:in|of)\s+/);2===e.length&&(r=e[0].trim(),c=e[1].trim())}const l=e.parentNode;if(!l)return;const a=document.createComment("z-for");l.insertBefore(a,e),e.remove(),e.removeAttribute("z-for");const u=e.getAttribute(":key")||e.getAttribute("z-key");u&&(e.removeAttribute(":key"),e.removeAttribute("z-key"));let d=/* @__PURE__ */new Map;const h=()=>{let n=E(c,t);n?._isRef&&(n=n.value),Array.isArray(n)||(n=[]);const s=/* @__PURE__ */new Map,i=[];n.forEach((n,c)=>{const l=u?E(u,{...t,[r]:{_isRef:!0,value:n},[o]:{_isRef:!0,value:c}}):c;i.push(l);const f=d.get(l);if(f)f.itemRef.value=n,f.indexRef.value=c,s.set(l,f);else{const i=e.cloneNode(!0),f=v(n),a=v(c),u=new g({...t,[r]:f,[o]:a});A(i,u.data,u),s.set(l,{clone:i,scope:u,itemRef:f,indexRef:a})}});for(const[e,t]of d)s.has(e)||(t.clone.remove(),t.scope.cleanup());let f=a;for(const e of i){const t=s.get(e);t.clone.previousSibling!==f&&l.insertBefore(t.clone,f.nextSibling),f=t.clone}d=s};return n.addEffect(f(h)),void n.addEffect(()=>{for(const e of d.values())e.scope.cleanup();d.clear()})}for(const{name:s,value:i}of[...e.attributes])if(s.startsWith("@")||s.startsWith("z-on:")){const r="@"===s[0]?s.slice(1):s.slice(5);e.removeAttribute(s);const o=e=>{const n=t[i];if("function"==typeof n)n(e);else try{Function(...Object.keys(t),"e",`"use strict";${i}`)(...Object.values(t),e)}catch(s){}};e.addEventListener(r,o),n.addListener(e,r,o)}else if("z-model"===s){e.removeAttribute(s);const r="checkbox"===e.type||"radio"===e.type,o=r?"checked":"value",c=r||"SELECT"===e.tagName?"change":"input",l=()=>{if("radio"===e.type&&!e.checked)return;const n=t[i];n?._isRef?n.value=e[o]:void 0!==t[i]&&(t[i]=e[o])};e.addEventListener(c,l),n.addListener(e,c,l),n.addEffect(f(()=>{const n=E(i,t);"radio"===e.type?e.checked=String(e.value)===String(n):e[o]=n}))}else if(s.startsWith(":")||s.startsWith("z-")){const r=":"===s[0]?s.slice(1):s;e.removeAttribute(s);const o="class"===r?e.className:"";n.addEffect(f(()=>{const n=E(i,t);if("z-text"===r)e.textContent=n??"";else if("z-html"===r)e.innerHTML=n??"";else if("z-show"===r)e.style.display=n?"":"none";else if("style"===r&&h(n))Object.assign(e.style,n);else if("class"===r)e.className=h(n)?(o+" "+Object.keys(n).filter(e=>n[e]).join(" ")).trim():"string"==typeof n?(o+" "+n).trim():o;else{const t=r.startsWith("z-")?r.slice(2):r;"boolean"==typeof n?n?e.setAttribute(t,""):e.removeAttribute(t):null==n?e.removeAttribute(t):e.setAttribute(t,n)}}))}[...e.childNodes].forEach(e=>A(e,t,n))}}}},z=/* @__PURE__ */new Set,x=(e,t={})=>{if(!z.has(e)&&"function"==typeof e.install){z.add(e);try{e.install({reactive:m,ref:v,computed:b,watchEffect:f,createApp:S,utils:{isObj:h,evalExp:E,Dep:n,ReactiveEffect:l}},t)}catch(s){}}},R=e=>Promise.resolve().then(e),S=e=>{let t=null;return{mount(n){const s=document.querySelector(n);if(!s)return;const i=e();return t=new g(i),A(s,i,t),this},unmount(){t&&(t.cleanup(),t=null)}}};export{b as computed,S as createApp,R as nextTick,m as reactive,v as ref,x as use,f as watchEffect};
